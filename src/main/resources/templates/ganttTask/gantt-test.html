<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>GanttTask API í…ŒìŠ¤íŠ¸</title>
  <style>
    body {
      font-family: "Noto Sans KR", sans-serif;
      background-color: #f4f6f9;
      margin: 0;
      padding: 40px;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 40px;
    }

    h2 {
      color: #34495e;
      border-left: 5px solid #3498db;
      padding-left: 10px;
      margin-bottom: 15px;
    }

    .card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      padding: 25px 30px;
      margin-bottom: 40px;
      transition: transform 0.2s ease;
    }

    .card:hover {
      transform: translateY(-3px);
    }

    button {
      background-color: #3498db;
      color: white;
      font-size: 16px;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    button:hover {
      background-color: #2980b9;
    }

    #create-result,
    #task-list-result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 6px;
      font-size: 15px;
      line-height: 1.5;
      background-color: #f8f9fa;
      white-space: pre-line;
    }

    .success {
      background-color: #e8f8f5;
      color: #1e8449;
      border: 1px solid #1e8449;
    }

    .error {
      background-color: #fdecea;
      color: #c0392b;
      border: 1px solid #c0392b;
    }

    .task-item {
      background-color: #f0f3f6;
      padding: 10px 12px;
      border-radius: 6px;
      margin-bottom: 8px;
    }

    hr {
      border: none;
      height: 1px;
      background: #ddd;
      margin: 40px 0;
    }
  </style>
</head>

<body>

  <h1>ğŸ—‚ï¸ GanttTask API í…ŒìŠ¤íŠ¸ í˜ì´ì§€</h1>

  <div class="card">
    <h2>ğŸ“Š í˜„ì¬ ì§„í–‰ ì¤‘ì¸ ì‘ì—… ëª©ë¡</h2>
    <div id="task-list-result"></div>
  </div>

  <hr>

  <div class="card">
    <h2>â• ì‘ì—… ë“±ë¡ (í…ŒìŠ¤íŠ¸ìš©)</h2>
    <button id="create-btn">í…ŒìŠ¤íŠ¸ ì‘ì—… 1ê°œ ë“±ë¡í•˜ê¸°</button>
    <div id="create-result"></div>
  </div>

  <script>
    const projectId = 1;

    const createBtn = document.getElementById("create-btn");
    const createResultDiv = document.getElementById("create-result");
    const readResultDiv = document.getElementById("task-list-result");

    // Auto-load task list on page load
    function loadTaskList() {
      readResultDiv.innerHTML = "â³ ì‘ì—… ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...";

      fetch(`/api/gantt/project/${projectId}`)
        .then(response => response.json())
        .then(tasks => {
          console.log("ì„œë²„ì—ì„œ ë°›ì€ ë°ì´í„°:", tasks);

          if (tasks.length === 0) {
            readResultDiv.className = "error";
            readResultDiv.textContent = "ğŸ“­ ë“±ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤.";
            return;
          }

          readResultDiv.className = "success";
          readResultDiv.innerHTML = "";

          tasks.forEach(task => {
            const taskElement = document.createElement("div");
            taskElement.className = "task-item";

            // D-day í‘œì‹œ ìŠ¤íƒ€ì¼ë§
            const dDayText = task.daysRemaining >= 0
              ? `D-${task.daysRemaining}`
              : `D+${Math.abs(task.daysRemaining)}`;

            const dDayColor = task.daysRemaining < 0
              ? '#c0392b'
              : task.daysRemaining <= 3
                ? '#e67e22'
                : '#27ae60';

            taskElement.innerHTML = `
              <strong>${task.name}</strong><br>
              <span style="color: ${dDayColor}; font-weight: bold; font-size: 16px;">${dDayText}ì¼ ë‚¨ìŒ</span> | 
              ì§„í–‰ë¥ : ${task.progress}% | 
              ê¸°ê°„: ${task.startDate} ~ ${task.endDate}
            `;
            readResultDiv.appendChild(taskElement);
          });
        })
        .catch(error => {
          console.error("API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          readResultDiv.className = "error";
          readResultDiv.textContent = "âŒ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (F12 ì½˜ì†” í™•ì¸)";
        });
    }

    // Load tasks when page loads
    window.addEventListener('DOMContentLoaded', loadTaskList);

    createBtn.onclick = function () {
      const testTaskData = {
        projectId: projectId,
        name: "ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì‘ì—…",
        startDate: "2025-11-10",
        endDate: "2025-11-20",
        assignedTo: 1,
        progress: 10
      };

      fetch("/api/gantt", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(testTaskData)
      })
        .then(response => {
          if (response.ok) {
            console.log("ì‘ì—… ë“±ë¡ ì„±ê³µ");
            createResultDiv.className = "success";
            createResultDiv.textContent = "âœ… 'ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì‘ì—…'ì´ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.";
            // Reload task list after creating new task
            setTimeout(loadTaskList, 500);
          } else {
            console.error("ì‘ì—… ë“±ë¡ ì‹¤íŒ¨");
            createResultDiv.className = "error";
            createResultDiv.textContent = "âŒ ì‘ì—… ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (F12 ì½˜ì†” í™•ì¸)";
          }
        })
        .catch(error => {
          console.error("API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
          createResultDiv.className = "error";
          createResultDiv.textContent = "âŒ API í˜¸ì¶œ ì˜¤ë¥˜. (F12 ì½˜ì†” í™•ì¸)";
        });
    };
  </script>

</body>

</html>